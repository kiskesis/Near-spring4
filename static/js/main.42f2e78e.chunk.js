(this.webpackJsonpfrontend=this.webpackJsonpfrontend||[]).push([[0],{143:function(t,e,n){},144:function(t,e,n){"use strict";n.r(e);var c=n(2),o=n(34),r=n.n(o),a=n(66),s=n(37),i=n(0),u=function(){return Object(i.jsxs)(c.Fragment,{children:[Object(i.jsx)("h1",{children:"NEAR Guest Book"}),Object(i.jsx)(s.a,{children:Object(i.jsx)(a.a,{})})]})};n(143);r.a.render(Object(i.jsx)(u,{}),document.getElementById("root"))},37:function(t,e,n){"use strict";n.d(e,"a",(function(){return m})),n.d(e,"b",(function(){return g}));var c=n(35),o=n(8),r=n(1),a=n.n(r),s=n(2),i=n.n(s),u=n(14),l=n(75),d=n(76),f=n(68),j=n(69),b=n(0),h=i.a.createContext(null),m=function(t){var e=t.children,n=Object(s.useState)(null),r=Object(o.a)(n,2),i=r[0],m=r[1],g=Object(s.useState)(null),p=Object(o.a)(g,2),O=p[0],x=p[1],v=Object(s.useState)([]),w=Object(o.a)(v,2),k=w[0],S=w[1],y=function(t,e){if(!e.length)return localStorage.removeItem("accountId"),x(null),void S([]);var n=t&&e.some((function(e){return e.accountId===t}))?t:e[0].accountId;localStorage.setItem("accountId",n),x(n),S(e)};return Object(s.useEffect)((function(){u.a.init({network:"testnet",contractId:"fourthchallenge.testnet",wallets:[Object(l.a)({iconUrl:f.a}),Object(d.a)({iconUrl:j.a})]}).then((function(t){return t.getAccounts().then(function(){var e=Object(c.a)(a.a.mark((function e(n){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:y(localStorage.getItem("accountId"),n),window.selector=t,m(t);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())})).catch((function(t){console.error(t),alert("Failed to initialise wallet selector")}))}),[]),Object(s.useEffect)((function(){if(i){var t=i.on("accountsChanged",(function(t){y(O,t.accounts)}));return function(){return t.remove()}}}),[i,O]),i?Object(b.jsx)(h.Provider,{value:{selector:i,accounts:k,accountId:O,setAccountId:x},children:e}):null};function g(){var t=Object(s.useContext)(h);if(!t)throw new Error("useWalletSelector must be used within a WalletSelectorContextProvider");return t}},66:function(t,e,n){"use strict";(function(t){var c=n(22),o=n(35),r=n(8),a=n(1),s=n.n(a),i=n(2),u=n(3),l=n(37),d=n(70),f=n(71),j=n(73),b=n(0),h=u.utils.format.parseNearAmount("0.00000000003");e.a=function(){var e=Object(l.b)(),n=e.selector,a=e.accounts,m=e.accountId,g=e.setAccountId,p=Object(i.useState)(null),O=Object(r.a)(p,2),x=O[0],v=O[1],w=Object(i.useState)([]),k=Object(r.a)(w,2),S=k[0],y=k[1],I=Object(i.useState)(!1),C=Object(r.a)(I,2),F=C[0],_=C[1],A=Object(i.useCallback)(Object(o.a)(s.a.mark((function t(){var e,o;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(m){t.next=2;break}return t.abrupt("return",null);case 2:return e=n.network.nodeUrl,o=new u.providers.JsonRpcProvider({url:e}),t.abrupt("return",o.query({request_type:"view_account",finality:"final",account_id:m}).then((function(t){return Object(c.a)(Object(c.a)({},t),{},{account_id:m})})));case 5:case"end":return t.stop()}}),t)}))),[m,n.network]),N=Object(i.useCallback)((function(){return new u.providers.JsonRpcProvider({url:n.network.nodeUrl}).query({request_type:"call_function",account_id:n.getContractId(),method_name:"get_messages",args_base64:"",finality:"optimistic"}).then((function(e){return JSON.parse(t.from(e.result).toString())}))}),[n]);Object(i.useEffect)((function(){N().then(y)}),[]),Object(i.useEffect)((function(){if(!m)return v(null);_(!0),A().then((function(t){v(t),_(!1)}))}),[m,A]);var E=Object(i.useCallback)((function(t){t.preventDefault();var e=t.target.elements,c=e.fieldset,o=e.message,r=e.donation;c.disabled=!0,n.signAndSendTransaction({signerId:m,actions:[{type:"FunctionCall",params:{methodName:"add_message",args:{message:o.value},gas:h,deposit:u.utils.format.parseNearAmount(r.value||"0")}}]}).catch((function(t){throw alert("Failed to add message"),console.log("Failed to add message"),t})).then((function(){return N().then((function(t){y(t),o.value="",r.value="0",c.disabled=!1,o.focus()})).catch((function(t){throw alert("Failed to refresh messages"),console.log("Failed to refresh messages"),t}))})).catch((function(t){console.error(t),c.disabled=!1}))}),[n,m,N]);return F?null:x?Object(b.jsxs)(i.Fragment,{children:[Object(b.jsxs)("div",{children:[Object(b.jsx)("button",{style:{marginRight:"15px"},onClick:function(){n.signOut().catch((function(t){console.log("Failed to sign out"),console.error(t)}))},children:"Log out"}),Object(b.jsx)("button",{onClick:function(){n.show()},children:"Switch Provider"}),a.length>1&&Object(b.jsx)("button",{onClick:function(){var t=a.findIndex((function(t){return t.accountId===m})),e=t<a.length-1?t+1:0,n=a[e].accountId;g(n),alert("Switched account to "+n)},children:"Switch Account"})]}),Object(b.jsx)(f.a,{account:x,onSubmit:function(t){return E(t)}}),Object(b.jsx)(j.a,{messages:S})]}):Object(b.jsxs)(i.Fragment,{children:[Object(b.jsx)("div",{children:Object(b.jsx)("button",{onClick:function(){n.show()},children:"Log in"})}),Object(b.jsx)(d.a,{})]})}}).call(this,n(12).Buffer)},70:function(t,e,n){"use strict";n.d(e,"a",(function(){return o}));n(2);var c=n(0);function o(){return Object(c.jsxs)(c.Fragment,{children:[Object(c.jsx)("p",{children:"This app demonstrates a key element of NEAR\u2019s UX: once an app has permission to make calls on behalf of a user (that is, once a user signs in), the app can make calls to the blockchain for them without prompting extra confirmation. So you\u2019ll see that if you don\u2019t include a donation, your message gets posted right to the guest book."}),Object(c.jsx)("p",{children:"But if you do add a donation, then NEAR will double-check that you\u2019re ok with sending money to this app."}),Object(c.jsx)("p",{children:"Go ahead and sign in to try it out!"})]})}},71:function(t,e,n){"use strict";n.d(e,"a",(function(){return a}));n(2);var c=n(72),o=n.n(c),r=n(0);function a(t){var e=t.onSubmit,n=t.account;return console.log("account",n),Object(r.jsx)("form",{onSubmit:e,children:Object(r.jsxs)("fieldset",{id:"fieldset",children:[Object(r.jsxs)("p",{children:["Sign the guest book, ",n.account_id,"!"]}),Object(r.jsxs)("p",{className:"highlight",children:[Object(r.jsx)("label",{htmlFor:"message",children:"Message:"}),Object(r.jsx)("input",{autoComplete:"off",autoFocus:!0,id:"message",required:!0})]}),Object(r.jsxs)("p",{children:[Object(r.jsx)("label",{htmlFor:"donation",children:"Donation (optional):"}),Object(r.jsx)("input",{autoComplete:"off",defaultValue:"0",id:"donation",max:o()(n.amount).div(Math.pow(10,24)).toString(),min:"0",step:"0.01",type:"number"}),Object(r.jsx)("span",{title:"NEAR Tokens",children:"\u24c3"})]}),Object(r.jsx)("button",{type:"submit",children:"Sign"})]})})}},73:function(t,e,n){"use strict";n.d(e,"a",(function(){return a}));var c=n(22),o=n(74),r=(n(2),n(0));function a(t){var e=t.messages,n=["#f08686","#ac84e2","#83dcb3","#de6ce8","#f2d256","#ff9b68"];return Object(r.jsxs)(r.Fragment,{children:[Object(r.jsx)("h2",{children:"Messages"}),function(t){var e={};Object(o.a)(new Set(t.map((function(t){return t.author})))).map((function(t,c){e[t]=n[c]}));return t.map((function(t){return Object(c.a)(Object(c.a)({},t),{},{color:e[t.author]})}))}(e).reverse().map((function(t,e){var n=new Date(parseInt(t.timestamp)/1e6),c=n.getDate(),o=n.getMonth()+1,a=n.getFullYear(),s=n.getHours(),i=n.getMinutes(),u=n.getSeconds(),l="".concat(c,".").concat(o,".").concat(a," ").concat(s,":").concat(i,":").concat(u);return Object(r.jsxs)("div",{style:{backgroundColor:t.color,padding:"5px",marginBottom:"5px"},className:t.deposit>0?"is-premium":"",children:[Object(r.jsx)("strong",{children:t.author}),":",Object(r.jsxs)("p",{className:"message-info",children:[Object(r.jsx)("span",{children:t.message}),Object(r.jsxs)("small",{children:["Was signed on: ",l]})]})]},e)}))]})}},90:function(t,e){},97:function(t,e){}},[[144,1,2]]]);
//# sourceMappingURL=main.42f2e78e.chunk.js.map