(this.webpackJsonpfrontend=this.webpackJsonpfrontend||[]).push([[0],{138:function(t,e,n){},139:function(t,e,n){"use strict";n.r(e);var c=n(2),o=n(32),a=n.n(o),r=n(64),s=n(34),i=n(0),u=function(){return Object(i.jsxs)(c.Fragment,{children:[Object(i.jsx)("h1",{children:"NEAR Guest Book"}),Object(i.jsx)(s.a,{children:Object(i.jsx)(r.a,{})})]})};n(138);a.a.render(Object(i.jsx)(u,{}),document.getElementById("root"))},34:function(t,e,n){"use strict";n.d(e,"a",(function(){return h})),n.d(e,"b",(function(){return b}));var c=n(33),o=n(8),a=n(1),r=n.n(a),s=n(2),i=n.n(s),u=n(14),l=n(70),d=n(71),f=n(0),j=i.a.createContext(null),h=function(t){var e=t.children,n=Object(s.useState)(null),a=Object(o.a)(n,2),i=a[0],h=a[1],b=Object(s.useState)(null),m=Object(o.a)(b,2),g=m[0],O=m[1],p=Object(s.useState)([]),x=Object(o.a)(p,2),v=x[0],w=x[1],k=function(t,e){if(!e.length)return localStorage.removeItem("accountId"),O(null),void w([]);var n=t&&e.some((function(e){return e.accountId===t}))?t:e[0].accountId;localStorage.setItem("accountId",n),O(n),w(e)};return Object(s.useEffect)((function(){u.a.init({network:"testnet",contractId:"fourthchallenge.testnet",wallets:[Object(l.a)(),Object(d.a)()]}).then((function(t){return t.getAccounts().then(function(){var e=Object(c.a)(r.a.mark((function e(n){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:k(localStorage.getItem("accountId"),n),window.selector=t,h(t);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())})).catch((function(t){console.error(t),alert("Failed to initialise wallet selector")}))}),[]),Object(s.useEffect)((function(){if(i){var t=i.on("accountsChanged",(function(t){k(g,t.accounts)}));return function(){return t.remove()}}}),[i,g]),i?Object(f.jsx)(j.Provider,{value:{selector:i,accounts:v,accountId:g,setAccountId:O},children:e}):null};function b(){var t=Object(s.useContext)(j);if(!t)throw new Error("useWalletSelector must be used within a WalletSelectorContextProvider");return t}},64:function(t,e,n){"use strict";(function(t){var c=n(44),o=n(33),a=n(8),r=n(1),s=n.n(r),i=n(2),u=n(3),l=n(34),d=n(66),f=n(67),j=n(69),h=n(0),b=u.utils.format.parseNearAmount("0.00000000003");e.a=function(){var e=Object(l.b)(),n=e.selector,r=e.accounts,m=e.accountId,g=e.setAccountId,O=Object(i.useState)(null),p=Object(a.a)(O,2),x=p[0],v=p[1],w=Object(i.useState)([]),k=Object(a.a)(w,2),S=k[0],I=k[1],y=Object(i.useState)(!1),F=Object(a.a)(y,2),C=F[0],A=F[1],N=Object(i.useCallback)(Object(o.a)(s.a.mark((function t(){var e,o;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(m){t.next=2;break}return t.abrupt("return",null);case 2:return e=n.network.nodeUrl,o=new u.providers.JsonRpcProvider({url:e}),t.abrupt("return",o.query({request_type:"view_account",finality:"final",account_id:m}).then((function(t){return Object(c.a)(Object(c.a)({},t),{},{account_id:m})})));case 5:case"end":return t.stop()}}),t)}))),[m,n.network]),_=Object(i.useCallback)((function(){return new u.providers.JsonRpcProvider({url:n.network.nodeUrl}).query({request_type:"call_function",account_id:n.getContractId(),method_name:"get_messages",args_base64:"",finality:"optimistic"}).then((function(e){return JSON.parse(t.from(e.result).toString())}))}),[n]);Object(i.useEffect)((function(){_().then(I)}),[]),Object(i.useEffect)((function(){if(!m)return v(null);A(!0),N().then((function(t){v(t),A(!1)}))}),[m,N]);var E=Object(i.useCallback)((function(t){t.preventDefault();var e=t.target.elements,c=e.fieldset,o=e.message,a=e.donation;c.disabled=!0,n.signAndSendTransaction({signerId:m,actions:[{type:"FunctionCall",params:{methodName:"add_message",args:{message:o.value},gas:b,deposit:u.utils.format.parseNearAmount(a.value||"0")}}]}).catch((function(t){throw alert("Failed to add message"),console.log("Failed to add message"),t})).then((function(){return _().then((function(t){I(t),o.value="",a.value="0",c.disabled=!1,o.focus()})).catch((function(t){throw alert("Failed to refresh messages"),console.log("Failed to refresh messages"),t}))})).catch((function(t){console.error(t),c.disabled=!1}))}),[n,m,_]);return C?null:x?Object(h.jsxs)(i.Fragment,{children:[Object(h.jsxs)("div",{children:[Object(h.jsx)("button",{onClick:function(){n.signOut().catch((function(t){console.log("Failed to sign out"),console.error(t)}))},children:"Log out"}),Object(h.jsx)("button",{onClick:function(){n.show()},children:"Switch Provider"}),r.length>1&&Object(h.jsx)("button",{onClick:function(){var t=r.findIndex((function(t){return t.accountId===m})),e=t<r.length-1?t+1:0,n=r[e].accountId;g(n),alert("Switched account to "+n)},children:"Switch Account"})]}),Object(h.jsx)(f.a,{account:x,onSubmit:function(t){return E(t)}}),Object(h.jsx)(j.a,{messages:S})]}):Object(h.jsxs)(i.Fragment,{children:[Object(h.jsx)("div",{children:Object(h.jsx)("button",{onClick:function(){n.show()},children:"Log in"})}),Object(h.jsx)(d.a,{})]})}}).call(this,n(12).Buffer)},66:function(t,e,n){"use strict";n.d(e,"a",(function(){return o}));n(2);var c=n(0);function o(){return Object(c.jsxs)(c.Fragment,{children:[Object(c.jsx)("p",{children:"This app demonstrates a key element of NEAR\u2019s UX: once an app has permission to make calls on behalf of a user (that is, once a user signs in), the app can make calls to the blockchain for them without prompting extra confirmation. So you\u2019ll see that if you don\u2019t include a donation, your message gets posted right to the guest book."}),Object(c.jsx)("p",{children:"But if you do add a donation, then NEAR will double-check that you\u2019re ok with sending money to this app."}),Object(c.jsx)("p",{children:"Go ahead and sign in to try it out!"})]})}},67:function(t,e,n){"use strict";n.d(e,"a",(function(){return r}));n(2);var c=n(68),o=n.n(c),a=n(0);function r(t){var e=t.onSubmit,n=t.accountId,c=t.account;return Object(a.jsx)("form",{onSubmit:e,children:Object(a.jsxs)("fieldset",{id:"fieldset",children:[Object(a.jsxs)("p",{children:["Sign the guest book, ",n,"!"]}),Object(a.jsxs)("p",{className:"highlight",children:[Object(a.jsx)("label",{htmlFor:"message",children:"Message:"}),Object(a.jsx)("input",{autoComplete:"off",autoFocus:!0,id:"message",required:!0})]}),Object(a.jsxs)("p",{children:[Object(a.jsx)("label",{htmlFor:"donation",children:"Donation (optional):"}),Object(a.jsx)("input",{autoComplete:"off",defaultValue:"0",id:"donation",max:o()(c.amount).div(Math.pow(10,24)).toString(),min:"0",step:"0.01",type:"number"}),Object(a.jsx)("span",{title:"NEAR Tokens",children:"\u24c3"})]}),Object(a.jsx)("button",{type:"submit",children:"Sign"})]})})}},69:function(t,e,n){"use strict";n.d(e,"a",(function(){return o}));n(2);var c=n(0);function o(t){var e=t.messages;return console.log("messages",e),Object(c.jsxs)(c.Fragment,{children:[Object(c.jsx)("h2",{children:"Messages"}),e.map((function(t,e){var n=new Date(parseInt(t.timestamp)/1e6),o=n.getDate(),a=n.getMonth()+1,r=n.getFullYear(),s=n.getHours(),i=n.getMinutes(),u=n.getSeconds(),l="".concat(o,".").concat(a,".").concat(r," ").concat(s,":").concat(i,":").concat(u);return Object(c.jsxs)("p",{className:t.deposit>0?"is-premium":"",children:[Object(c.jsx)("strong",{children:t.author}),":",Object(c.jsxs)("p",{className:"message-info",children:[Object(c.jsx)("span",{children:t.message}),Object(c.jsxs)("small",{children:["Was signed on: ",l]})]})]},e)}))]})}},85:function(t,e){},92:function(t,e){}},[[139,1,2]]]);
//# sourceMappingURL=main.0f58231f.chunk.js.map